<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ==================== SECTION 1: HEAD & META INFORMATION ==================== -->
    <meta charset="UTF-8">
    <title>Prescription Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="assets/icon.png" type="image/png">
</head>

<body>
    <!-- ==================== SECTION 2: MAIN DASHBOARD LAYOUT ==================== -->
    <div class="dashboard-container">
        
        <!-- ==================== SECTION 3: PRESCRIPTION FORM SECTION ==================== -->
        <div class="main-form">
            
            <!-- Header & Navigation -->
            <div class="header-container" style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="dashboard-title" id="dashboardTitle">Prescription Generator</h2>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="clearBtn" class="header-btn">Clear</button>
                    <button id="settingsBtn" class="header-btn">‚öôÔ∏è Settings</button>
                </div>
            </div>
            
            <!-- Edit Mode Indicator -->
            <div id="editModeIndicator" class="edit-mode-indicator" style="margin-top: 10px;"></div>
            
            <!-- Usage Counter -->
            <div class="counter-display" id="counterDisplay">
                Prescriptions Remaining: <span id="remainingCount">5</span>
            </div>
            
            <!-- Patient Information Form -->
            <div class="header-row">
                <input type="text" id="pName" placeholder="Patient Name" style="flex: 1.5;">
                <select id="pSex" style="flex: 0.5;">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
                <input type="text" id="pAge" placeholder="Age" style="flex: 0.4;">
                <input type="text" id="pMobile" placeholder="Mobile Number" style="flex: 1.2;">
                <input type="date" id="pDate" style="flex: 0.8;">
            </div>
            
            <!-- Mobile Validation Warning -->
            <div id="mobileWarning" class="mobile-warning">
                Mobile Number matches with an existing one!
            </div>
            
            <!-- Clinical & Medical Information Section -->
            <div style="display: flex; gap: 20px; margin-top: 10px;">
                
                <!-- Clinical Findings Column -->
                <div style="flex: 1;">
                    <div class="input-group">
                        <label style="font-weight:bold; font-size: 11px; color:#0056b3;">CLINICAL FINDINGS</label>
                        <textarea id="ccInput" placeholder="C/C (Chief Complaint)" rows="2"></textarea>
                        
                        <div class="examination-heading">ON EXAMINATION (O/E)</div>
                        <textarea id="oeInput" placeholder="Enter Examination Findings" rows="2"></textarea>
                        
                        <div style="display:flex; gap:5px; margin-top: 10px;">
                            <input type="text" id="pulseInput" placeholder="Pulse">
                            <input type="text" id="bpInput" placeholder="B.P">
                            <input type="text" id="tempInput" placeholder="Temperature">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label style="font-weight:bold; font-size: 11px; color:#0056b3;">INVESTIGATION</label>
                        <textarea id="invInput" style="min-height: 110px;" placeholder="Enter Test Names" rows="4"></textarea>
                    </div>
                </div>
                
                <!-- Medication Column -->
                <div style="flex: 2;">
                    <div class="input-group">
                        <label style="font-weight:bold; font-size: 11px; color:#0056b3;">MEDICINE (Rx)</label>
                        
                        <!-- Previous Prescription Dropdown -->
                        <div id="previousPrescriptionsContainer" style="display: none; text-align: center;">
                            <label style="font-size: 12px; color: #0056b3; margin-bottom: 5px; font-weight: 600; display: flex; flex-direction: column;">Previous Prescriptions:</label>
                            <select id="previousPrescriptionsDropdown" style="width: 150px; padding: 6px 10px; border: 1px solid #0056b3; border-radius: 4px; font-size: 12px; color: #333; background: white; cursor: pointer; text-align: center;">
                                <option value="default" disabled selected>Select Prescription</option>
                            </select>
                        </div>
                        
                        <!-- Add Prescription Button -->
                        <div id="addPrescriptionContainer" style="display: flex;">
                            <button id="addPrescriptionBtn" class="btn-add">
                                + Add Prescription
                            </button>
                        </div>
                        
                        <!-- Medicine Table Container -->
                        <div id="medicineTableContainer" style="display: none;">
                            <table class="med-table">
                                <thead>
                                    <tr>
                                        <th style="width: 200px; align-item: left;">Name</th>
                                        <th style="width: 55px; align-item: center;">Qty</th>
                                        <th style="width: 80px; align-item: center;">Unit</th>
                                        <th style="width: 110px; align-item: center;">Dose</th>
                                        <th style="width: 90px; align-item: center;">Freq</th>
                                        <th style="width: 65px; align-item: center;">Duration</th>
                                        <th style="width: 150px; align-item: center;">Relation to Meal</th>
                                        <th style="width: 150px; align-item: right;">Note</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody id="medBody"></tbody>
                            </table>
                            <div style="display: flex; flex-direction: row; gap: 10px;">
                                <button class="btn-add" id="addMed" style="font-size: 11px;">+ Medicine</button>
                                <button class="btn-add" id="addNewPrescriptionBtn" style="font-size: 11px; background-color: #6c757d; cursor: not-allowed;" disabled>+ New Prescription</button>
                                
                                <!-- Preset Controls -->
                                <button class="btn-preset" id="savePresetBtn" disabled>+ Save as Preset +</button>
                                <select id="loadPresetDropdown">
                                    <option value="" selected disabled>Load Preset--></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="button-container">
                <button class="btn-save" id="savePrescriptionBtn">Save Prescription</button>
                <button class="btn-gen" id="generateBtn">Generate & Print Prescription</button>
            </div>
        </div>
        
        <!-- ==================== SECTION 4: PATIENT HISTORY SIDEBAR ==================== -->
        <div class="history-sidebar">
            <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #0056b3; padding-bottom: 5px;">
                <h3 style="margin:0; font-size: 16px;">Patient History</h3>
                <div style="display: flex; gap: 5px;">
                    <button id="importExportBtn" class="export-btn">üìÅ Import/Export</button>
                    <button id="bulkPrintBtn" class="export-btn">Print All</button>
                </div>
            </div>
            
            <input type="text" id="histSearch" placeholder="üîç Search Name, Date, or Mobile...">
            <ul id="historyList"></ul>
        </div>
    </div>

    <!-- ==================== SECTION 5: SETTINGS MODAL ==================== -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Prescription Settings</h3>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            
            <div class="settings-grid">
                <!-- Doctor Information -->
                <div class="settings-section">
                    <h4>Doctor Information</h4>
                    <div class="settings-input">
                        <label>Doctor's Name</label>
                        <input type="text" id="doctorName" placeholder="Dr. Arif Aziz">
                    </div>
                    <div class="settings-input">
                        <label>Qualifications</label>
                        <input type="text" id="doctorQualification" placeholder="MBBS [Dhaka (DU)], General Practitioner">
                    </div>
                    <div class="settings-input">
                        <label>Registration Number</label>
                        <input type="text" id="doctorRegNumber" placeholder="B.M & D.C Reg. No: [Available upon request]">
                    </div>
                    <div class="settings-input">
                        <label>Specialization/Experience</label>
                        <input type="text" id="doctorExperience" placeholder="Experienced in Conventional Medicine, Hijama & Lifestyle Modification">
                    </div>
                </div>

                <!-- Contact Information -->
                <div class="settings-section">
                    <h4>Contact Information</h4>
                    <div class="settings-input">
                        <label>Appointment Contact</label>
                        <input type="text" id="appointmentContact" placeholder="+8801521101236">
                    </div>
                    <div class="settings-input">
                        <label>Email (Optional)</label>
                        <input type="text" id="doctorEmail" placeholder="doctor@example.com">
                    </div>
                    <div class="settings-input">
                        <label>Clinic/Hospital Address</label>
                        <textarea id="clinicAddress" rows="3" placeholder="123 Medical Street, City, Country"></textarea>
                    </div>
                </div>

                <!-- Header Logo -->
                <div class="settings-section">
                    <h4>Header Logo</h4>
                    <div class="settings-input">
                        <label>Right Side Logo</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="headerLogoInput" accept="image/*">
                            <span class="file-input-label">Choose Logo</span>
                        </div>
                    </div>
                    <div class="logo-preview-container">
                        <div>
                            <div class="preview-label">Preview:</div>
                            <div class="logo-preview">
                                <img id="headerLogoPreview" src="assets/logo.png" alt="Header Logo Preview">
                            </div>
                        </div>
                        <div style="font-size: 12px; color: #666;">
                            <strong>Note:</strong> This logo appears on the top right of the prescription.<br><br>
                            Recommended size: 100√ó100 pixels<br>
                            Formats: PNG, JPG, SVG
                        </div>
                    </div>
                </div>

                <!-- Footer & Watermark -->
                <div class="settings-section">
                    <h4>Footer & Watermark</h4>
                    <div class="settings-input">
                        <label>Clinic/Hospital Name (Footer)</label>
                        <input type="text" id="hospitalName" placeholder="DOCTOR'S NEST">
                    </div>
                    <div class="settings-input">
                        <label>Hospital Name Font Size</label>
                        <div class="fontsize-controls">
                            <input type="range" id="hospitalFontSize" min="20" max="60" value="36">
                            <span class="fontsize-value" id="fontSizeValue">36px</span>
                        </div>
                    </div>
                    <div class="settings-input">
                        <label>Watermark Logo (Background)</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="watermarkLogoInput" accept="image/*">
                            <span class="file-input-label">Choose Watermark</span>
                        </div>
                    </div>
                    <div class="watermark-controls">
                        <label>Watermark Opacity:</label>
                        <input type="range" id="watermarkOpacity" min="1" max="100" value="8">
                        <span class="watermark-value" id="opacityValue">8%</span>
                    </div>
                    <div class="logo-preview-container">
                        <div>
                            <div class="preview-label">Watermark Preview:</div>
                            <div class="logo-preview" style="background: #f0f0f0;">
                                <img id="watermarkLogoPreview" src="assets/watermark.png" alt="Watermark Preview" style="opacity: 0.08;">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Doctor's Signature -->
            <div class="settings-section">
                <h4>Doctor's Signature</h4>
                <div class="settings-input">
                    <div class="signature-controls">
                        <div class="file-input-wrapper">
                            <input type="file" id="signatureInput" accept=".jpg,.jpeg,.png">
                            <span class="file-input-label">Upload Signature</span>
                        </div>
                        <button id="removeSignatureBtn" class="btn-remove-signature">Remove Signature</button>
                    </div>
                </div>
                
                <div class="logo-preview-container">
                    <div>
                        <div class="signature-preview" id="signaturePreviewContainer">
                            <img id="signaturePreview" src="assets/sign.png" alt="Signature Preview">
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Medicine Preset Section -->
            <div class="settings-section">
                <h4>Medicine Presets</h4>
                
                <div id="presetStats" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Total Presets:</span>
                        <span id="presetCount" style="color: #0056b3; font-weight: bold;">0</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Total Medicines in Presets:</span>
                        <span id="presetMedicineCount">0</span>
                    </div>
                </div>
                
                <div style="margin-top: 10px; display: flex; gap: 10px;">
                    <button id="managePresetsBtn" class="header-btn" style="background: #0056b3; color: white; font-size: 11px;">
                        ‚öôÔ∏è Manage Presets
                    </button>
                </div>
                
                <div style="font-size: 11px; color: #666; margin-top: 10px;">
                    <strong>Note:</strong> Presets allow you to save and quickly load common medicine combinations.
                </div>
            </div>

            <!-- Medicine Database Section -->
            <div class="settings-section">
                <h4>Medicine Database</h4>
                
                <!-- Database Stats -->
                <div id="databaseStats" style="background: #f8f9fa; padding: 10px; border-radius: 5px; margin-bottom: 15px; font-size: 12px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>Database Status:</span>
                        <span id="dbStatus" style="color: #dc3545; font-weight: bold;">Not Loaded</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span>Medicines Count:</span>
                        <span id="dbCount">0</span>
                    </div>
                </div>
                
                <!-- Upload CSV Section -->
                <div class="settings-input">
                    <label>Upload Medicine Database (CSV/JSON)</label>
                    <div class="file-input-wrapper">
                        <input type="file" id="medicineDatabaseInput" accept=".csv,.txt,.json">
                        <span class="file-input-label">Choose CSV/JSON File</span>
                    </div>
                    <div style="font-size: 11px; color: #666; margin-top: 5px;">
                        <strong>CSV Format:</strong> name, quantity, unit, dose, frequency, days, meal, note
                    </div>
                </div>
                
                <!-- Database Management Buttons -->
                <div style="margin-top: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button id="downloadSampleCSV" class="header-btn" style="background: #6c757d; color: white; font-size: 11px;">
                        üì• Download Sample CSV
                    </button>
                    <button id="exportDatabase" class="header-btn" style="background: #28a745; color: white; font-size: 11px;">
                        üì§ Export Database
                    </button>
                    <button id="clearDatabase" class="header-btn" style="background: #dc3545; color: white; font-size: 11px;">
                        üóëÔ∏è Clear Database
                    </button>
                </div>
                
                <!-- Medicine Preview -->
                <div style="margin-top: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 5px; padding: 10px;">
                    <h5 style="margin: 0 0 10px 0; color: #0056b3; font-size: 14px;">Database Preview</h5>
                    <div id="medicinePreview" style="font-size: 11px; color: #666;">
                        No medicine database loaded.
                    </div>
                </div>
            </div>

            <!-- Prescription Preview -->
            <div class="settings-section">
                <h4>Preview</h4>
                <div id="prescriptionPreview" style="border: 1px solid #e0e0e0; padding: 15px; border-radius: 5px; background: white; max-height: 200px; overflow-y: auto; font-size: 12px;">
                    <p><strong>Header:</strong> <span id="previewDoctorName">Dr. Arif Aziz</span></p>
                    <p><strong>Qualifications:</strong> <span id="previewQualifications">MBBS [Dhaka (DU)], General Practitioner</span></p>
                    <p><strong>Footer:</strong> <span id="previewHospitalName">DOCTOR'S NEST</span></p>
                    <p><strong>Contact:</strong> <span id="previewContact">+8801521101236</span></p>
                    <p><strong>Signature Status:</strong> <span id="previewSignatureStatus">Default signature will be used</span></p>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-cancel" id="cancelSettings">Cancel</button>
                <button class="btn-save-settings" id="saveSettings">Save Settings</button>
            </div>
        </div>
    </div>

    <!-- ==================== SECTION 6: PAYMENT MODAL ==================== -->
    <div id="paymentModal" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title">üöÄ Upgrade to Premium</h3>
                <button class="close-modal" id="closePaymentModal">&times;</button>
            </div>

            <!-- Trial Expired Alert -->
            <div style="background:#fff3cd;border:2px dashed #ffc107;border-radius:8px;padding:15px;margin-bottom:20px;text-align:center;">
                <strong style="color:#d35400;font-size:16px;">‚ö†Ô∏è Free Trial Expired</strong><br>
                <span style="color:#555;">You have used all <strong>5 free prescriptions</strong></span>
            </div>

            <!-- Trial Extension Packages -->
            <h3 style="text-align:center;color:#28a745;margin-bottom:10px;">
                üîÑ Trial Extension Packages
            </h3>

            <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;">
                <div class="package-card">
                    <div class="pkg-count">5 Prescriptions</div>
                    <div class="pkg-price">BDT 100</div>
                    <div class="pkg-note">Light usage</div>
                </div>

                <div class="package-card popular">
                    <div class="badge">Most Popular</div>
                    <div class="pkg-count">10 Prescriptions</div>
                    <div class="pkg-price">BDT 200</div>
                    <div class="pkg-note">Regular OPD</div>
                </div>

                <div class="package-card">
                    <div class="pkg-count">15 Prescriptions</div>
                    <div class="pkg-price">BDT 300</div>
                    <div class="pkg-note">Busy clinic</div>
                </div>

                <div class="package-card">
                    <div class="pkg-count">20 Prescriptions</div>
                    <div class="pkg-price">BDT 400</div>
                    <div class="pkg-note">High patient load</div>
                </div>

                <div class="package-card">
                    <div class="pkg-count">30 Prescriptions</div>
                    <div class="pkg-price">BDT 500</div>
                    <div class="pkg-note">Weekly OPD</div>
                </div>

                <div class="package-card best">
                    <div class="badge gold">Best Value</div>
                    <div class="pkg-count">50 Prescriptions</div>
                    <div class="pkg-price">BDT 700</div>
                    <div class="pkg-note">Save more üí∞</div>
                </div>
            </div>

            <!-- Lifetime Premium -->
            <div style="margin-top:25px;border:3px solid #28a745;border-radius:10px;padding:20px;background:#f6fffa;">
                <h2 style="text-align:center;color:#28a745;margin-bottom:10px;">
                    üèÜ Lifetime Premium
                </h2>

                <div style="text-align:center;font-size:30px;font-weight:bold;color:#0056b3;">
                    BDT <strike style="color:#dc3545;">10000</strike> 5000
                </div>

                <p style="text-align:center;color:#555;margin:10px 0;">
                    One-time Payment ‚Ä¢ Unlimited Prescriptions ‚Ä¢ No Expiry
                </p>
            </div>

            <!-- Payment Method -->
            <div class="premium-payment-card">
                <div class="method-badge">Direct Transfer</div>
                
                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 5px;">
                    <div style="font-size: 24px;">üì±</div>
                    <h4 style="margin:0; color:#0056b3; font-size: 16px;">Mobile Banking Payment</h4>
                </div>
                
                <p style="margin:5px 0; font-size: 13px; color: #666;">Please send the amount to this personal number (click to copy):</p>
                
                <div id="payment-number" class="number-container" title="Click to Copy">
                    +8801682773995
                </div>
                
                <div class="provider-icons">
                    <span style="display: flex; align-items: center; gap: 4px;">üü¢ bKash</span>
                    <span style="display: flex; align-items: center; gap: 4px;">üü† Nagad</span>
                    <span style="display: flex; align-items: center; gap: 4px;">üîµ Rocket</span>
                </div>
            </div>
            
            <!-- After Payment Steps -->
            <div class="after-payment-box">
                <div class="after-payment-title">
                    <span>üìù</span> After Payment Process:
                </div>
                <ul class="after-payment-steps">
                    <li>
                        <span class="step-number">1</span>
                        <span>Take a <b>Screenshot</b> or <b>Note the Transaction ID</b> of your payment.</span>
                    </li>
                    <li>
                        <span class="step-number">2</span>
                        <span>Send it to <b>WhatsApp: +8801682773995</b> or <b>Email: iqbalhasanhira.com</b></span>
                    </li>
                    <li>
                        <span class="step-number">3</span>
                        <span>You will receive a unique <b> Activation Code</b> within 5-10 minutes.</span>
                    </li>
                </ul>
            </div>

            <!-- Unlock Section -->
            <div id="unlockSection" style="display:none;margin-top:15px;">
                <input type="text" id="unlockCode" class="transaction-input" placeholder="Enter the code provided after payment.">
                <div id="unlockStatus" class="status-message" style="display: none; margin-top: 10px; padding: 8px; border-radius: 4px; font-size: 12px;"></div>
                <button id="verifyUnlockCode" class="btn-unlock">‚úÖ Verify & Unlock</button>
            </div>

            <button id="showUnlockSection" class="btn-unlock">
                üîì I Have Already Paid - Enter Code
            </button>

            <!-- Support Info -->
            <div style="text-align:center;margin-top:20px;font-size:12px;color:#666;">
                Support: <strong>+8801682773995</strong><br>
                Developed by <a href="https://www.facebook.com/iqbal271194" target="_blank" class="author-link">Md. Iqbal Hasan</a>
            </div>
        </div>
    </div>

    <!-- ==================== SECTION 7: IMPORT/EXPORT MODAL ==================== -->
    <div id="importExportModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">üìÅ Import & Export Patient History</h3>
                <button class="close-modal" id="closeImportExportModal">&times;</button>
            </div>
            
            <!-- Tabs for Import/Export -->
            <div style="display: flex; border-bottom: 2px solid #e0e0e0; margin-bottom: 20px;">
                <button id="exportTab" class="header-btn" style="border-radius: 0; border-bottom: 3px solid #0056b3; background: transparent; color: #0056b3;">Export History</button>
                <button id="importTab" class="header-btn" style="border-radius: 0; background: transparent; color: #666;">Import History</button>
            </div>
            
            <!-- Export Section -->
            <div id="exportSection">
                <div class="export-info">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <strong>üìä Export your patient history to backup or transfer data.</strong><br>
                        Your data will be exported as a JSON file that can be imported later.
                    </p>
                </div>
                
                <div class="export-stats" id="exportStats">
                    <!-- Stats will be populated by JavaScript -->
                </div>
                
                <div style="margin: 25px 0;">
                    <div class="import-export-options">
                        <div class="option-card">
                            <div class="option-icon">üíæ</div>
                            <div class="option-title">Local Drive Export</div>
                            <div class="option-desc">Download your patient history as a JSON file to your computer for backup or transfer.</div>
                        </div>
                    </div>
                </div>
                
                <button id="exportNowBtn" class="btn-download">
                    <span>üíæ Download Patient History</span>
                </button>
                
                <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 5px; font-size: 12px; color: #666;">
                    <strong>üí° Tip:</strong> Regular backups ensure your patient data is safe. Export your history monthly.
                </div>
            </div>
            
            <!-- Import Section -->
            <div id="importSection" style="display: none;">
                <div class="export-info">
                    <p style="margin: 0; font-size: 14px; color: #856404;">
                        <strong>üìÇ Import patient history from backup files.</strong><br>
                        Supported formats: JSON files exported from this extension.
                    </p>
                </div>
                
                <!-- File Drop Area -->
                <div class="file-drop-area" id="fileDropArea">
                    <div class="file-drop-icon">üìÅ</div>
                    <div class="file-drop-text">Drop your backup file here</div>
                    <div class="file-drop-subtext">or click to browse files</div>
                    <input type="file" id="importFileInput" accept=".json,application/json" style="display: none;">
                </div>
                
                <!-- Uploaded File Info -->
                <div id="uploadedFileInfo" class="uploaded-file-info" style="display: none;">
                    <div class="file-icon">‚úÖ</div>
                    <div class="file-details">
                        <div class="file-name" id="uploadedFileName">backup.json</div>
                        <div class="file-size" id="uploadedFileSize">15.2 KB</div>
                    </div>
                    <button id="removeFileBtn" class="btn-remove" style="padding: 5px 10px;">Remove</button>
                </div>
                
                <!-- Import Mode Selection -->
                <div class="import-mode-container">
                    <h4 class="import-mode-title">Import Mode</h4>
                    <div class="import-mode-options">
                        <label class="import-mode-option" data-mode="merge">
                            <input type="radio" name="importMode" value="merge" checked>
                            <div class="import-mode-header">
                                <div class="import-mode-icon">üîÑ</div>
                                <div class="import-mode-name">Merge</div>
                            </div>
                            <div class="import-mode-desc">
                                Add imported data to existing history while avoiding duplicates. This is the safest option.
                            </div>
                            <div class="import-mode-check"></div>
                        </label>
                        
                        <label class="import-mode-option" data-mode="replace">
                            <input type="radio" name="importMode" value="replace">
                            <div class="import-mode-header">
                                <div class="import-mode-icon">üîÑ</div>
                                <div class="import-mode-name">Replace</div>
                            </div>
                            <div class="import-mode-desc">
                                Replace all existing history with imported data. Current data will be permanently deleted.
                            </div>
                            <div class="import-mode-check"></div>
                        </label>
                        
                        <label class="import-mode-option" data-mode="append">
                            <input type="radio" name="importMode" value="append">
                            <div class="import-mode-header">
                                <div class="import-mode-icon">‚ûï</div>
                                <div class="import-mode-name">Append</div>
                            </div>
                            <div class="import-mode-desc">
                                Add all imported data at the end of existing history. This may create duplicate records.
                            </div>
                            <div class="import-mode-check"></div>
                        </label>
                    </div>
                </div>
                
                <!-- Warning Note -->
                <div class="warning-note">
                    <strong>‚ö†Ô∏è Warning:</strong> Always backup your current data before importing to avoid data loss.
                </div>
                
                <!-- Import Button -->
                <button id="importNowBtn" class="btn-import" disabled>
                    <span>üì§ Import Patient History</span>
                </button>
            </div>
            
            <div class="modal-footer">
                <button class="btn-cancel" id="cancelImportExport">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ==================== SECTION 8: ALERT & NOTIFICATION MODALS ==================== -->
    <div id="customAlertModal" class="modal">
        <div class="modal-content" style="max-width: 500px; border-radius: 10px; overflow: hidden;">       
            <div class="modal-header" style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 20px; display: flex; justify-content: center; align-items: center; position: relative;">                
                <h3 class="modal-title" style="margin: 0; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 20px; width: 100%;">
                    <span id="alertIcon" style="font-size: 28px; display: inline-block;">‚ö†Ô∏è</span>
                    <span id="alertTitle">Warning!</span>
                </h3>
                <button class="close-modal" id="closeAlertModal" style="color: white; font-size: 32px; padding: 0; position: absolute; right: 20px; top: 50%; transform: translateY(-50%); cursor: pointer; border: none; background: transparent;">&times;</button>
            </div>
            
            <div class="modal-body" style="padding: 30px; text-align: center; background: #fff8f8;">
                <div style="margin-bottom: 25px;">
                    <div style="font-size: 72px; color: #dc3545; margin-bottom: 15px;" id="alertBigIcon">‚ö†Ô∏è</div>
                    
                    <p id="alertMessage" style="font-size: 16px; line-height: 1.6; color: #721c24; background: #f8d7da; padding: 12px; border-radius: 6px; border-left: 4px solid #dc3545;">
                        This action is permanent and cannot be undone.<br>
                        All prescription data will be lost forever.
                    </p>
                    <p style="font-size: 15px; color: #666; margin-top: 20px; font-weight: 500;">
                        Are you absolutely sure?
                    </p>
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: center; gap: 20px; padding: 25px; background: #f9f9f9; border-top: 1px solid #eee;">
                <button id="alertCancelBtn" class="btn-cancel" style="padding: 14px 40px; font-weight: bold; font-size: 16px; border: 2px solid #6c757d; background: white; color: #6c757d; min-width: 140px;">No, Keep It</button>
                <button id="alertConfirmBtn" class="btn-remove" style="padding: 14px 40px; background: linear-gradient(135deg, #dc3545, #c82333); color: white; border: none; border-radius: 6px; font-weight: bold; font-size: 16px; min-width: 140px; box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);">Yes, Delete</button>
            </div>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content" style="max-width: 450px; border-radius: 10px; overflow: hidden; text-align: center;">
            <div class="modal-header" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; padding: 20px; border-bottom: none;">
                <h3 class="modal-title" style="margin: 0; display: flex; align-items: center; justify-content: center; gap: 12px; font-size: 20px; width: 100%;">
                    <span>‚úÖ Success!</span>
                </h3>
                <button class="close-modal" id="closeSuccessModal" style="color: white; font-size: 32px; padding: 0;">&times;</button>
            </div>
            <div class="modal-body" style="padding: 30px;">
                <div style="font-size: 64px; color: #28a745; margin-bottom: 15px;">‚úÖ</div>
                <h4 id="successTitle" style="color: #28a745; margin: 0 0 10px 0; font-size: 20px; font-weight: bold;"></h4>
                <p id="successMessage" style="font-size: 16px; line-height: 1.5; color: #333;"></p>
            </div>
            <div class="modal-footer" style="padding: 20px;">
                <button id="closeSuccessBtn" class="btn-save-settings" style="padding: 12px 40px; margin: 0 auto; display: block;">Close</button>
            </div>
        </div>
    </div>

    <!-- ==================== SECTION 9: PRESET MANAGEMENT MODALS ==================== -->
    <!-- Preset Name Input Modal -->
    <div id="presetModal" class="modal">
        <div class="modal-content preset-modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #0056b3, #004085); color: white; padding: 20px; border-bottom: none;">
                <h3 class="modal-title" style="margin: 0; font-size: 18px; text-align: center; width: 100%;">Preset Name</h3>
                <button class="close-modal" id="closePresetModal" style="color: white; font-size: 32px; padding: 0; background: transparent; border: none; cursor: pointer; position: absolute; right: 20px;">&times;</button>
            </div>
            <div class="preset-modal-body">
                <input type="text" id="presetNameInput" class="preset-input" placeholder="Enter preset name" maxlength="50">
                <div class="button-container" style="justify-content: center; gap: 10px;">
                    <button id="presetCancelBtn" class="btn-cancel" style="padding: 8px 20px;">Cancel</button>
                    <button id="presetSaveBtn" class="btn-save-settings" style="padding: 8px 30px;">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preset Management Modal -->
    <div id="presetManagementModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Manage Presets</h3>
                <button class="close-modal" id="closePresetManagementModal">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin: 0 0 15px 0; font-size: 14px; color: #666;">
                    Manage your saved medicine presets. Click on a preset to load it, or remove unused ones.
                </p>
                
                <div id="presetList" class="preset-management-section">
                    <!-- Presets will be loaded here -->
                </div>
                
                <div class="preset-info">
                    <strong>Note:</strong> Presets are stored locally in your browser.
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-cancel" id="closePresetManagementBtn">Close</button>
            </div>
        </div>
    </div>
    
    <!-- ==================== SECTION 10: JAVASCRIPT FILES ==================== -->
    <script src="js/storage-manager.js"></script>
    <script src="js/main.js"></script>
    <script src="js/form-manager.js"></script>
    <script src="js/history-manager.js"></script>
    <script src="js/edit-mode-manager.js"></script>
    <script src="js/settings-manager.js"></script>
    <script src="js/premium-manager.js"></script>
    <script src="js/import-export-manager.js"></script>
    <script src="js/alert-manager.js"></script>
    <script src="js/database-manager.js"></script>
    <script src="js/preset-manager.js"></script>
    <script src="js/print-manager.js"></script>
    
</body>

</html>




